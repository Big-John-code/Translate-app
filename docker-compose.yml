services:
  libretranslate:
    container_name: libretranslate
    build:
      context: .
      dockerfile: docker/Dockerfile
    image: libretranslate/libretranslate:custom
    ports:
      - "5001:5000"
    restart: unless-stopped
    healthcheck:
      test: ['CMD-SHELL', './venv/bin/python scripts/healthcheck.py']
      interval: 10s
      timeout: 4s
      retries: 4
      start_period: 5s
    tty: true
    environment:
      - LT_LOAD_ONLY=en,uk
      # MADLAD-400-3B (Google, 3B params) - кращий за NLLB-200 3.3B
      - LT_MADLAD_REFINER=true
      - LT_MADLAD_MODEL=google/madlad400-3b-mt
      - LT_MADLAD_CT2_DIR=/hf_cache/madlad400-3b-ct2-int8
      # NLLB-200 3.3B - вимкнений поки активний MADLAD (увімкни якщо хочеш fallback)
      - LT_NLLB_REFINER=false
      - LT_NLLB_CT2_DIR=/hf_cache/nllb-200-3.3B-ct2-int8
      - HF_HOME=/hf_cache
    volumes:
      - libretranslate_models:/home/libretranslate/.local:rw
      - /Volumes/Neyo/libretranslate_hf_cache:/hf_cache:rw

volumes:
  libretranslate_models:
